{% extends "base_generic.html" %}

{% block content %}

<div>
    {% comment %} 탭을 만들어야 함 {% endcomment %}
</div>

{% comment %} 검색창 부분 {% endcomment %}
<div>
    <form action="{% url 'CompareSearch' %}" method="GET" id="compareSearchForm">
        <div>
            <input type="text" name="q" placeholder="{{user.best_pad}}"/>
            <input type="hidden" name="compareConditionList" value=""/> 
            <br/>
        </div>
        보다
        <div>        
            <div>
                <input type="checkbox" value="price">저렴한
                <input type="checkbox" value="absorbency">흡수력 좋은
                <input type="checkbox" value="comfort">촉감/착용감 좋은
                <input type="checkbox" value="nature_friendly">자연유래정도 높은
                <input type="checkbox" value="anti_odour">탈취성 좋은
                <input type="checkbox" value="sensitivity">피부 트러블 덜 나는
            </div>
        </div>
        제품 찾아주세요
        <input type="button" value="검색" id="compareSearchBtn"/>
    </form>    
</div>

{% comment %} 최초에 /comparesearch/ url로 접근했을 때는 아래의 내용이 보이지 않음 {% endcomment %}
{% if first_page == False %}
    <div>
        <p>총 {{ product_list|length }}개의 상품이 검색되었습니다</p>
        <hr/> 
        <select>
            <option value="">정확도순</option>
        </select>
    </div>
        
    <div>
        <ul>
            {% for reviewSummary in page_obj %}
            <li>
                <div onclick="location.href='{{reviewSummary.product_fk.get_absolute_url}}'">
                    <img src="{{reviewSummary.product_fk.image.url}}" alt="제품 이미지"/>
                    <p>{{ reviewSummary.product_fk.hashtag_fk.name }}</p>
                    <h2>{{ reviewSummary.product_fk.name }}</h2>
                    <h3>{{ reviewSummary.product_fk.category }}</h3>            
                </div>
            </li>
            {% empty %}
            <p>'{{searchedWord}}'에 해당하는 검색결과가 없습니다.</p> 
            {% endfor %}
        </ul>
    </div>

    {% comment %} pagination {% endcomment %}
    <div class="pagination">
        <span class="step-links">
            {% if page_obj.has_previous %}
                <a href="?page=1{% if request.GET.compareConditionList %}&amp;compareConditionList={{request.GET.compareConditionList}}{% endif %}{% if request.GET.q %}&amp;q={{request.GET.q}}{% endif %}">&laquo; first</a>
                <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.compareConditionList %}&amp;compareConditionList={{request.GET.compareConditionList}}{% endif %}{% if request.GET.q %}&amp;q={{request.GET.q}}{% endif %}">previous</a>
            {% endif %}

            <span class="current">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
            </span>

    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% if request.GET.compareConditionList %}&amp;compareConditionList={{request.GET.compareConditionList}}{% endif %}{% if request.GET.q %}&amp;q={{request.GET.q}}{% endif %}">next</a>
        <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.compareConditionList %}&amp;compareConditionList={{request.GET.compareConditionList}}{% endif %}{% if request.GET.q %}&amp;q={{request.GET.q}}{% endif %}">last &raquo;</a>
    {% endif %}
        </span>
    </div>

{% endif %}

<script type="text/javascript">
    window.onload = function(){        
        document.getElementById('compareSearchBtn').onclick = function(){
            var form = document.getElementById('compareSearchForm');
            var checkList = document.querySelectorAll("input[type='checkbox']:checked");
            var checkListStr = "";

            if( checkList.length > 0 ){                
                checkList.forEach(function(ele){
                    checkListStr += ele.value + ",";
                });
                checkListStr = checkListStr.substring(0, checkListStr.length - 1);
            }

            // 유효성 체크
            if(form.q.value == ''){
                alert("검색어를 입력해주세요");
                form.q.focus();
                return;
            }

            if(checkListStr == ''){
                alert("비교조건을 선택해주세요");
                return;
            }

            form.compareConditionList.value = checkListStr;
            form.submit();     
        }
    }
</script>

{% endblock %}



