{% extends "base_generic.html" %}
{% load static %}

{% block content %}

<div class="contents-detail-page container">

    <div class="link-box">
        <div>
            <h2>공유하고 싶은 나만의 이야기가 있다면?</h2>
            <span>나의 작은 이야기가 누군가에게는 큰 도움이 될 수 있다는 것</span>
        </div>
        <div>
            <a href="{% url 'user-story-form' %}">나의 이야기 나누러가기</a>
        </div>
    </div>

    <div class="contents-box">
        <img src="{{ user_story.image.url }}"/>
        <h2>{{ user_story.title }}</h2>
        <span>{{ user_story.created_at|date:"Y.m.d" }}</span>

        <div>
            <div>
                <span>조회수<strong>{{ user_story.hits }}</strong></span>
                <span id="like"><i class="fas fa-heart{% if is_like %} active{% endif %}"></i><strong>{{ user_story.total_likes }}</strong></span>
                <span>M-Type<strong>{{ user_story.mtype }}</strong></span>
            </div>
            <a href="javascript:void(0);"><i class="fas fa-share-alt"></i>공유하기</a>
        </div>

        <p>{{ user_story.content|safe }}</p>
    </div>

</div>

<script type="text/javascript">
    document.getElementById('like').addEventListener('click', check_like);

    function check_like() {
        {% if request.user.is_active %}
            var self = this;

            var xhr = new XMLHttpRequest();
            var url = "/board/contents/{{ user_story.id }}/like";
            xhr.open('GET', url);
            xhr.onload = function() {
                if(xhr.status === 200) {
                    var total_likes = xhr.responseText;
                    var i = self.childNodes[0];
                    var strong = self.childNodes[1];
                    
                    i.classList.toggle('active');
                    strong.innerHTML = total_likes;
                } else {
                    alert('좋아요 실패');
                }
            }
            xhr.send();
        {% else %}
            alert('로그인이 필요합니다');
        {% endif %}
    }
</script>
    
{% endblock %}